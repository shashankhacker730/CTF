# [Lab]Meow

1.使用 IDA Pro 將程式打開，從 main 函數中大概可以知道程式的流程，一樣會有一個地方要求輸入 flag ，然後第 11 行可以看到，會先檢查輸入的字串長度為 39，並且還有後面三個函數的檢查，sub_401884、sub_401723、sub_401C37，接下來我們要分別分析這三個函數是做什麼事情。

![截圖 2022-11-22 下午10.19.14.png](%5BLab%5DMeow%2019104aff06564770b0c356c829b21d49/%25E6%2588%25AA%25E5%259C%2596_2022-11-22_%25E4%25B8%258B%25E5%258D%258810.19.14.png)

2.sub_401884 → sub401550 中可以看到，在第 11 行及第 12 行，會對一串 memory 進行解密，而這邊這個 dword_404040 裡面存的是一個執行檔案，而 sub_401884 這個函數分析完也可以知道它這邊是在做 Process halloween。

![截圖 2022-11-22 下午10.28.15.png](%5BLab%5DMeow%2019104aff06564770b0c356c829b21d49/%25E6%2588%25AA%25E5%259C%2596_2022-11-22_%25E4%25B8%258B%25E5%258D%258810.28.15.png)

3.sub_401723 函數，這邊IDA pro 逆出的程式碼，還滿清楚的，這邊有一個 name pipe 的管道，叫做 pipe meow，會透過這個管道溝通，並且利用 WirteFile 對 name pipe 寫資料，利用 readfile 讀取資料。

![截圖 2022-11-22 下午10.37.41.png](%5BLab%5DMeow%2019104aff06564770b0c356c829b21d49/%25E6%2588%25AA%25E5%259C%2596_2022-11-22_%25E4%25B8%258B%25E5%258D%258810.37.41.png)

4.因為已經知道這邊在做 process hallowin，因此我們這邊只需要將程式 dump出來，而我這邊 dump 的方式是用 x64dbg，使用 scylla 的方式將檔案 dump 出來。

![截圖 2022-11-22 下午10.43.31.png](%5BLab%5DMeow%2019104aff06564770b0c356c829b21d49/%25E6%2588%25AA%25E5%259C%2596_2022-11-22_%25E4%25B8%258B%25E5%258D%258810.43.31.png)

5.得到 dump 出來的 PE File 之後，也可以很清楚看出來這支程式的運作方式。

![截圖 2022-11-22 下午11.02.35.png](%5BLab%5DMeow%2019104aff06564770b0c356c829b21d49/%25E6%2588%25AA%25E5%259C%2596_2022-11-22_%25E4%25B8%258B%25E5%258D%258811.02.35.png)

6.然後是 sub_401C37，從底下可以知道這個函數是在進行 flag 的 check。

![截圖 2022-11-22 下午11.07.27.png](%5BLab%5DMeow%2019104aff06564770b0c356c829b21d49/%25E6%2588%25AA%25E5%259C%2596_2022-11-22_%25E4%25B8%258B%25E5%258D%258811.07.27.png)

7.最後，可以得知原本的檔案，會將字串傳入dump 出來的這支程式，進行加密，然後再回傳給原本的程式，因此，我們只需要將 enc flag 從這邊進行解密，即可得到 FLAG{pr0c355_h0ll0w1ng_4nd_n4m3d_p1p35}

![截圖 2022-11-22 下午11.04.39.png](%5BLab%5DMeow%2019104aff06564770b0c356c829b21d49/%25E6%2588%25AA%25E5%259C%2596_2022-11-22_%25E4%25B8%258B%25E5%258D%258811.04.39.png)