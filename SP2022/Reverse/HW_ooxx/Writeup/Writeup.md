# [HW] ooxx

1. 先執行這支程式，發現是要贏得遊戲來取的 flag，於是嘗試手動去玩這支程式，但看起來結果都是 X Win! 或是 Tie 。

1. 於是我有兩個想法來贏得遊戲，第一個是在程式最後判斷輸贏的地方更改程式執行的邏輯，讓我贏，第二個是找到方法修改初始化方格，一開始就有兩格是圈圈，我只要再填一格就可以贏，我這邊先嘗試第一個方法，所以我開始去尋找最後判斷輸贏的函數位置。

1. 然後使用 IDA 來觀察這隻程式，找找看哪一個函數有使用到 Messagebox，且包含 win 或是 tie 這個字串的函數，這邊花了很多時間在 IDA 裡面翻 winMain 函數裡面的函數，於是在 winMain → sub_140001C50 → sub_1400017F0  找到這個函數猜測它會判斷輸贏或是平手。
    
    ![截圖 2022-11-06 下午11.12.40.png](%5BHW%5D%20ooxx%20ad9135755e6d41bca55ded0209fc52ca/%25E6%2588%25AA%25E5%259C%2596_2022-11-06_%25E4%25B8%258B%25E5%258D%258811.12.40.png)
    

1. 接下來去分析這邊每個函數的內容，發現 MessageBoxA，輸出的原本字串，被存成 Text[i]=-number，一個負號的數字，然後會經過 sub_14001480 會將字串解密才輸出，這也解釋了為什麼我無法搜尋到 win 的字串，於是我去看了 sub_14001480 發現裡面的解密過程有點複雜，於是我想有沒有辦法可以不用逆出這個函數，也可以解出這題。

1. 仔細觀察 Judgement ( sub_1400017F0 )  這個函數，裡面其實只有三個 比較主要的 if ，這邊猜測其中一個跳過，可以進入 “O win”，於是 x64dbg 中分別找到這三個 if 的位置 ( ida顯示的位址會和實際process的位址不一樣， 0000000140001871 的 RVA 是 0x1871 )，然後使用 ctrl + G 搜尋 “:$1871”，就可以在 x64dbg 中找到它的位址。

![截圖 2022-11-06 下午11.17.02.png](%5BHW%5D%20ooxx%20ad9135755e6d41bca55ded0209fc52ca/%25E6%2588%25AA%25E5%259C%2596_2022-11-06_%25E4%25B8%258B%25E5%258D%258811.17.02.png)

1. 找到他的位址後，就想辦法嘗試讓它不要跳轉，而我這邊用的辦法是直接將 je 改為 nop，將它填滿 Nop，再直接執行程式。結果我試了第一個 if ( sub_1400014D0() ) 的時候 ( RVA在 0x1810)，執行程式後會直接跳到 ”X win”，因此可以確認第一個 if 是 X win! 的 Branch。

![截圖 2022-11-07 上午1.27.19.png](%5BHW%5D%20ooxx%20ad9135755e6d41bca55ded0209fc52ca/%25E6%2588%25AA%25E5%259C%2596_2022-11-07_%25E4%25B8%258A%25E5%258D%25881.27.19.png)

![截圖 2022-11-07 上午1.30.56.png](%5BHW%5D%20ooxx%20ad9135755e6d41bca55ded0209fc52ca/%25E6%2588%25AA%25E5%259C%2596_2022-11-07_%25E4%25B8%258A%25E5%258D%25881.30.56.png)

![截圖 2022-11-07 上午1.27.40.png](%5BHW%5D%20ooxx%20ad9135755e6d41bca55ded0209fc52ca/%25E6%2588%25AA%25E5%259C%2596_2022-11-07_%25E4%25B8%258A%25E5%258D%25881.27.40.png)

1. 同樣的方式，試了第二個 else if ( (unsigned int)sub_140001640() ) ，它 branch 的RVA在 0x1871， 然後這邊一樣用 Nop 將 jz loc_1400194D 填滿 5個 byte，執行程式後，結果就跳出 “O Win!” 的視窗，因此到這邊可以確定這個是 O win！的 Branch。

![截圖 2022-11-06 下午11.20.36.png](%5BHW%5D%20ooxx%20ad9135755e6d41bca55ded0209fc52ca/%25E6%2588%25AA%25E5%259C%2596_2022-11-06_%25E4%25B8%258B%25E5%258D%258811.20.36.png)

![截圖 2022-11-06 下午11.51.20.png](%5BHW%5D%20ooxx%20ad9135755e6d41bca55ded0209fc52ca/%25E6%2588%25AA%25E5%259C%2596_2022-11-06_%25E4%25B8%258B%25E5%258D%258811.51.20.png)

1. 按確認後，就可以成功贏得遊戲並獲得FLAG(YOu_Won_A_gaM3_yoU_cOuldnOT_p05s16ly.w1n}

![截圖 2022-11-06 下午4.51.16.png](%5BHW%5D%20ooxx%20ad9135755e6d41bca55ded0209fc52ca/%25E6%2588%25AA%25E5%259C%2596_2022-11-06_%25E4%25B8%258B%25E5%258D%25884.51.16.png)

![截圖 2022-11-06 下午4.53.19.png](%5BHW%5D%20ooxx%20ad9135755e6d41bca55ded0209fc52ca/%25E6%2588%25AA%25E5%259C%2596_2022-11-06_%25E4%25B8%258B%25E5%258D%25884.53.19.png)

Note. 參考資料

1. [https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messageboxa](https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messageboxa)