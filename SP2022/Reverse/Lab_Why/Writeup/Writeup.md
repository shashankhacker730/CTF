# [LAB] Why

# LAB_why

1. 先對程式做一些基本檢查，大概看一下檔案格式，及裡面有哪些字串。

![截圖 2022-11-03 下午9.22.49.png](%5BLAB%5D%20Why%20c4491504d08f444f8557f5599d36873d/%25E6%2588%25AA%25E5%259C%2596_2022-11-03_%25E4%25B8%258B%25E5%258D%25889.22.49.png)

1. 直接使用 IDA 去看程式的 main 函數，發現 buf[i] - 10 ! = enc_flag[i]，會 return 0，猜測 buf 應該跟 flag 有關係，還有去追 pass 是幹嘛的 ，看起來 sub_11f8() ，會做一些check。

![截圖 2022-11-03 下午9.23.50.png](%5BLAB%5D%20Why%20c4491504d08f444f8557f5599d36873d/%25E6%2588%25AA%25E5%259C%2596_2022-11-03_%25E4%25B8%258B%25E5%258D%25889.23.50.png)

![截圖 2022-11-03 下午9.26.53.png](%5BLAB%5D%20Why%20c4491504d08f444f8557f5599d36873d/%25E6%2588%25AA%25E5%259C%2596_2022-11-03_%25E4%25B8%258B%25E5%258D%25889.26.53.png)

1. 然後 sub_119d 看起來是在做 2’s 補數運算。

![截圖 2022-11-03 下午9.45.32.png](%5BLAB%5D%20Why%20c4491504d08f444f8557f5599d36873d/%25E6%2588%25AA%25E5%259C%2596_2022-11-03_%25E4%25B8%258B%25E5%258D%25889.45.32.png)

1. 於是開始去猜測 flag 、enc_flag、跟二補數有什麼關係，這邊我沒有很理解，從逆向的角度去看，感覺要還需要花一點時間去 trace 程式碼，但如果從密碼學的角度去推敲，我直接猜他的運算位移介於 -256 ~ 0 ，於是直接嘗試爆破 for i in range(256): if(enc_flag[0] - i) =="F"，結果 i = 10 的時候，enc_flag[0] -10 = ‘F’，及 enc_flag[1] -10 = ‘L’，於是這邊覺得 enc_flag 跟 flag 的關係應該是 enc_flag - 10 會等於 flag。

1. 所以我就直接寫一個 script enc_flag[i] - 10 搜集完所有的值，於是就得到 FLAG{init_fini_mprotect!}
    
    ```python
    FLAG=""
    addr = 0x4030
    enc_flag = idc.get_bytes(addr, 100)
    for i in range(50):
        FLAG+=str(chr(enc_flag[i]-10))
    print(FLAG)
    ```